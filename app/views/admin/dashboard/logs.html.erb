<div class="admin-dashboard">
  <div class="admin-header">
    <div class="back-link">
      <%= link_to admin_root_path do %>
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      <% end %>
    </div>
    <h1>System Logs</h1>
    <p class="admin-subtitle">Monitor system activity and events</p>
  </div>

  <!-- Log Filters -->
  <div class="filters-container">
    <%= form_with url: admin_logs_path, method: :get, class: "filters-form" do |f| %>
      <div class="filter-group">
        <%= f.label :level, "Log Level:" %>
        <%= f.select :level, 
          options_for_select([
            ["All Levels", ""], 
            ["Error", "error"], 
            ["Warning", "warning"], 
            ["Info", "info"], 
            ["Debug", "debug"]
          ], params[:level]), {}, { class: "filter-select" } %>
      </div>
      
      <div class="filter-group">
        <%= f.label :date, "Date:" %>
        <%= f.date_field :date, value: params[:date] || Date.today, class: "filter-input" %>
      </div>
      
      <%= f.submit "Apply Filters", class: "btn btn-primary" %>
      <%= link_to "Clear Filters", admin_logs_path, class: "btn btn-secondary" %>
    <% end %>
  </div>

  <!-- Logs Table -->
  <div class="admin-section">
    <div class="section-header">
      <h2>System Activity</h2>
      <div class="total-count">
        <%= page_entries_info @logs, entry_name: 'log entry' %>
      </div>
    </div>
    
    <div class="table-responsive">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Level</th>
            <th>Message</th>
            <th>Context</th>
          </tr>
        </thead>
        <tbody>
          <% @logs.each do |log| %>
            <tr class="log-entry <%= log.level.downcase %>">
              <td><%= log.created_at.strftime("%b %d, %Y %H:%M:%S") %></td>
              <td>
                <span class="log-level <%= log.level.downcase %>">
                  <%= log.level %>
                </span>
              </td>
              <td><%= log.message %></td>
              <td>
                <% if log.context.present? %>
                  <button class="btn btn-sm btn-info view-context" data-context="<%= log.context %>">
                    View Context
                  </button>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    
    <div class="pagination-container">
      <%= paginate @logs %>
    </div>
  </div>
</div>

<!-- Context Modal -->
<div id="contextModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Log Context</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <pre class="context-data"></pre>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('contextModal');
    const contextData = modal.querySelector('.context-data');
    const closeBtn = modal.querySelector('.close-modal');
    
    // View context buttons
    document.querySelectorAll('.view-context').forEach(button => {
      button.addEventListener('click', function() {
        const context = JSON.parse(this.dataset.context);
        contextData.textContent = JSON.stringify(context, null, 2);
        modal.style.display = 'block';
      });
    });
    
    // Close modal
    closeBtn.addEventListener('click', function() {
      modal.style.display = 'none';
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
</script>

<style>
  /* Log specific styles */
  .log-entry {
    font-family: monospace;
    font-size: 13px;
  }
  
  .log-entry.error {
    background-color: #fff5f5;
  }
  
  .log-entry.warning {
    background-color: #fffbea;
  }
  
  .log-entry.info {
    background-color: #f0f7ff;
  }
  
  .log-entry.debug {
    background-color: #f9f9f9;
  }
  
  .log-level {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
  }
  
  .log-level.error {
    background-color: #ffecee;
    color: #e63a52;
  }
  
  .log-level.warning {
    background-color: #fff4db;
    color: #e69500;
  }
  
  .log-level.info {
    background-color: #e6f7ff;
    color: #0066cc;
  }
  
  .log-level.debug {
    background-color: #f0f0f0;
    color: #666;
  }
  
  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    z-index: 1000;
  }
  
  .modal-content {
    position: relative;
    background-color: white;
    margin: 10% auto;
    padding: 0;
    width: 80%;
    max-width: 800px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  
  .modal-header {
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .modal-header h3 {
    margin: 0;
    font-size: 18px;
    color: #333;
  }
  
  .close-modal {
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
    padding: 0;
  }
  
  .close-modal:hover {
    color: #333;
  }
  
  .modal-body {
    padding: 20px;
    max-height: 60vh;
    overflow-y: auto;
  }
  
  .context-data {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 4px;
    font-family: monospace;
    font-size: 13px;
    line-height: 1.5;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .modal-content {
      width: 95%;
      margin: 5% auto;
    }
  }
</style> 